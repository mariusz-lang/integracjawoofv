(()=>{var e={184:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var a=typeof n;if("string"===a||"number"===a)e.push(n);else if(Array.isArray(n)){if(n.length){var c=o.apply(null,n);c&&e.push(c)}}else if("object"===a)if(n.toString===Object.prototype.toString)for(var s in n)r.call(n,s)&&n[s]&&e.push(s);else e.push(n.toString())}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.element,t=window.wc.blocksCheckout,r=window.wp.i18n,o=JSON.parse('{"apiVersion":2,"name":"woocommerce/eu-vat-number","version":"1.0.0","title":"EU VAT Number","parent":["woocommerce/checkout-fields-block"],"category":"woocommerce","icon":"cart","description":"The EU VAT Number extension lets you collect and validate EU VAT numbers during checkout to identify B2B transactions verses B2C. IP Addresses can also be validated to ensure they match the billing address. EU businesses with a valid VAT number can have their VAT removed prior to payment.","supports":{"html":false},"textdomain":"woocommerce-eu-vat-number","attributes":{"lock":{"type":"object","default":{"remove":true,"move":false}}}}'),a=window.wp.compose,c=window.wc.wcSettings;var s=n(184),i=n.n(s);const l=(e,t)=>{const n={AT:/^(AT)?U[A-Z\d]{8}$/,BE:/^(BE)(0\d{9}|1\d{9})$/,BG:/^(BG)?\d{9,10}$/,CY:/^(CY)?\d{8}[A-Z]$/,CZ:/^(CZ)?\d{8,10}$/,DE:/^(DE)?\d{9}$/,DK:/^(DK)?(\d{2} ?){3}\d{2}$/,EE:/^(EE)?\d{9}$/,EL:/^(EL)?\d{9}$/,ES:/^(ES)?[A-Z]\d{7}[A-Z]|\d{8}[A-Z]|[A-Z]\d{8}$/,FI:/^(FI)?\d{8}$/,FR:/^(FR)?([A-Z]{2}|[A-Z0-9]{2})?\d{9}$/,XI:/^(XI)?\d{9}|\d{12}|(GD|HA)\d{3}$/,HR:/^(HR)?\d{11}$/,HU:/^(HU)?\d{8}$/,IE:/^(IE)?[A-Z\d]{8,10}$/,IT:/^(IT)?\d{11}$/,LT:/^(LT)?(\d{9}|\d{12})/,LU:/^(LU)?\d{8}$/,LV:/^(LV)?\d{11}$/,MT:/^(MT)?\d{8}$/,NL:/^(NL)?\d{9}B\d{2}$/,PL:/^(PL)?\d{10}$/,PT:/^(PT)?\d{9}$/,RO:/^(RO)?\d{2,10}$/,SE:/^(SE)?\d{12}$/,SI:/^(SI)?\d{8}$/,SK:/^(SK)?\d{10}$/};if(n[e]){let r=n[e];return"PL"===e?r.test(t)&&function(e){const t=[6,5,7,2,3,4,5,6,7];let n=0;for(let r=0;r<9;r++)n+=t[r]*e[r];let r=n%11;return(10===r?0:r)===parseInt(e[9])}(t):r.test(t)}return!0},u=e=>{switch(e){case"AT":return"ATU12345678";case"BE":return"BE123456789 / BE0123456789";case"BG":return"BG123456789 / BG0123456789";case"CY":return"CY12345678X";case"CZ":return"CZ12345678 / CZ123456789 / CZ1234567890";case"DE":return"DE123456789";case"DK":return"DK12345678";case"EE":return"EE123456789";case"GR":case"EL":return"EL123456789";case"ES":return"ESX12345678 / ES12345678X / ESX1234567X";case"EU":return"EU123456789";case"FI":return"FI12345678";case"FR":return"FR12345678901 / FRX1234567890 / FR1X123456789 / FRXX123456789";case"GB":return"GB123456789";case"HR":return"HR12345678901";case"HU":return"HU12345678";case"IE":return"IE1234567WA / IE1234567FA";case"IT":return"IT12345678901";case"LV":return"LV12345678901";case"LT":return"LT123456789 / LT123456789012 ";case"LU":return"LU12345678";case"MT":return"MT12345678";case"NL":return"NL123456789B01";case"NO":return"NO123456789";case"PL":return"1234567890";case"PT":return"PT123456789";case"RO":return"RO1234567890";case"RS":return"RS123456789";case"SI":return"SI12345678";case"SK":return"SK1234567890";case"SE":return"SE123456789012";default:return""}},m=({shouldValidateIp:n,billingCountry:o,ipAddress:a,ipCountry:s,validation:i,checkoutExtensionData:l})=>{const u=(0,c.getSetting)("allowedCountries",{}),{setExtensionData:m}=l;let d=o;u[o]&&(d=u[o]);const{setValidationErrors:p,clearValidationError:b,getValidationError:v}=i,[E,_]=(0,e.useState)(!1),[h,w]=(0,e.useState)(!1),f="billing_vat_number_ip_address_notice",g=(0,r.sprintf)(/* translators: %1$s is the user's IP address, %2$s is the billing country name */
(0,r.__)("Your IP Address (%1$s) does not match your billing country (%2$s). European VAT laws require your IP address to match your billing country when purchasing digital goods in the EU. Please confirm you are located within your billing country using the checkbox above.","woocommerce-fakturownia"),a,d),k=n&&o!==s;if((0,e.useEffect)((()=>(!E&&k&&p({[f]:{message:g,hidden:!h}}),E&&b(f),()=>{b(f)})),[p,E,h]),!k)return null;const y=v(f);return(0,e.createElement)("div",{className:"wc-eu-vat-checkout-ip-notice"},(0,e.createElement)("div",{className:"wc-eu-vat-checkout-ip-notice__checkbox-container"},(0,e.createElement)(t.CheckboxControl,{name:"location_confirmation",className:!1===y?.hidden?"has-error":"",label:(0,e.createInterpolateElement)((0,r.sprintf)(/* translators: %s is the billing country full name, e.g. Finland, France, or Spain. */
(0,r.__)("I am established, have my permanent address, or usually reside within <strong>%s</strong>.","woocommerce-fakturownia"),d),{strong:(0,e.createElement)("strong",null)}),checked:E,onChange:e=>{h||w(!0),_(e),m("woocommerce-eu-vat-number","location_confirmation",e)}})),y?.message&&!y?.hidden?(0,e.createElement)("div",{className:"wc-block-components-validation-error",role:"alert"},(0,e.createElement)("p",null,y.message)):null)},d=({defaultTitle:e=(0,r.__)("Step","woocommerce-eu-vat-number"),defaultDescription:t=(0,r.__)("Step description text.","woocommerce-eu-vat-number"),defaultShowStepNumber:n=!0})=>({title:{type:"string",default:e},description:{type:"string",default:t},showStepNumber:{type:"boolean",default:n}}),p=({title:t,stepHeadingContent:n})=>(0,e.createElement)("div",{className:"wc-block-components-checkout-step__heading"},(0,e.createElement)("h2",{"aria-hidden":"true",className:"wc-block-components-checkout-step__title wc-block-components-title"},t),!!n&&(0,e.createElement)("span",{className:"wc-block-components-checkout-step__heading-content"},n)),b=(v=d({}),t=>n=>{const r=((e,t)=>{const n=[];return Object.keys(e).forEach((r=>{if(void 0!==t[r])switch(e[r].type){case"boolean":n[r]="false"!==t[r]&&!1!==t[r];break;case"number":n[r]=parseInt(t[r],10);break;case"array":case"object":n[r]=JSON.parse(t[r]);break;default:n[r]=t[r]}else n[r]=e[r].default})),n})(v,n);return(0,e.createElement)(t,{...n,...r})})((({id:t,className:n,title:r,legend:o,description:a,children:c,disabled:s=!1,showStepNumber:l=!0,stepHeadingContent:u=(()=>{})})=>{const m=o||r?"fieldset":"div";return(0,e.createElement)(m,{className:i()(n,"wc-block-components-checkout-step",{"wc-block-components-checkout-step--with-step-number":l,"wc-block-components-checkout-step--disabled":s}),id:t,disabled:s},!(!o&&!r)&&(0,e.createElement)("legend",{className:"screen-reader-text"},o||r),!!r&&(0,e.createElement)(p,{title:r,stepHeadingContent:u()}),(0,e.createElement)("div",{className:"wc-block-components-checkout-step__container"},!!a&&(0,e.createElement)("p",{className:"wc-block-components-checkout-step__description"},a),(0,e.createElement)("div",{className:"wc-block-components-checkout-step__content"},c)))}));var v;const E=({validation:n,checkoutExtensionData:o})=>{const{setExtensionData:a}=o,{setValidationErrors:c,clearValidationError:s,getValidationError:i}=n,[l,u]=(0,e.useState)(!1),[m,d]=(0,e.useState)(!1),p="billing_vat_number_tax_notice",b=(0,r.__)("If your company is already registered for EU VAT check this field.","woocommerce-fakturownia");(0,e.useEffect)((()=>(l||c({[p]:{message:b,hidden:!m}}),l&&s(p),()=>{s("billing_vat_number_error"),s(p)})),[c,l,m]);const v=i(p);return(0,e.createElement)("div",{className:"wc-eu-vat-checkout-vat-notice"},(0,e.createElement)("div",{className:"wc-eu-vat-checkout-vat-notice__checkbox-container"},(0,e.createElement)(t.CheckboxControl,{name:"location_confirmation",className:!1===v?.hidden?"has-error":"",label:(0,r.__)("I am already registered in VAT EU","woocommerce-fakturownia"),checked:l,onChange:e=>{m||d(!0),u(e),a("woocommerce-eu-vat-number","location_confirmation",e)}})),v?.message&&!v?.hidden?(0,e.createElement)("div",{className:"wc-block-components-validation-error",role:"alert"},(0,e.createElement)("p",null,v.message)):null)},_=(0,a.withInstanceId)((n=>{const{checkoutExtensionData:o}=n,{setValidationErrors:a,clearValidationError:s,getValidationError:d}=n.validation,{cart:p,extensions:v}=n,{billingAddress:_}=p,{title:h=(0,r.__)("Numer NIP","woocommerce-eu-vat-number"),description:w="",showStepNumber:f=!0}=n,g=(0,c.getSetting)("woocommerce-eu-vat-number_data"),k="yes"===g.validate_ip_country,y="yes"===g.is_eu_vat_enabled,S="billing_vat_number_error",N=d(S),x="n"===g.generate_invoice||"p"===g.generate_invoice,[I,T]=(0,e.useState)(!1),[C,A]=(0,e.useState)(v["woocommerce-eu-vat-number"]?.billing_invoice_ask),[$,L]=(0,e.useState)(v["woocommerce-eu-vat-number"]?.billing_vat_number),[V,U]=(0,e.useState)(-1!==g.eu_countries.indexOf(_.country));(0,e.useEffect)((()=>{A(v["woocommerce-eu-vat-number"]?.billing_invoice_ask),L(v["woocommerce-eu-vat-number"]?.billing_vat_number)}),[v]),(0,e.useEffect)((()=>{o.setExtensionData("woocommerce-eu-vat-number","billing_invoice_ask",!1),o.setExtensionData("woocommerce-eu-vat-number","vat_confirmation",!1),o.setExtensionData("woocommerce-eu-vat-number","location_confirmation",!1)}),[o.setExtensionData]),(0,e.useEffect)((()=>{U(-1!==g.eu_countries.indexOf(_.country))}),[g.eu_countries,_.country]),(0,e.useEffect)((()=>{const e=v["woocommerce-eu-vat-number"]?.validation.error;e&&a({[S]:{message:e,hidden:!1}})}),[v,a,s,$]);const P=v["woocommerce-eu-vat-number"]?.validation.valid;return(0,e.useEffect)((()=>{const e=sprintf((0,r.__)("Wprowadzony numer NIP (%s) jest nieprawidłowy. Użyj następującego formatu: %s","woocommerce-eu-vat-number"),$,u(_.country));let t=l(_.country,$);$&&!t&&a({[S]:{message:e,hidden:!0}}),$&&P&&s(S)}),[a,s,C,$,_]),(0,e.createElement)(b,{id:"shipping-fields",className:i()("wc-block-checkout__shipping-fields","eu-vat-extra-css"),title:h,description:w,showStepNumber:f},(0,e.createElement)("div",null,x&&(0,e.createElement)(t.CheckboxControl,{id:"billing_invoice_ask",checked:C,onChange:e=>{A(e),e||L(""),I||T(!0)},label:(0,r.__)("Chcę fakturę","woocommerce-fakturownia"),value:"1"}),(C||!x)&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t.ValidatedTextInput,{id:"billing_vat_number",type:"text",className:!1===N?.hidden?"has-error":"",label:(0,r.__)("Numer NIP","woocommerce-fakturownia"),value:$,onChange:e=>{L(e),I||T(!0)},onBlur:()=>{V&&y?(()=>{let e=l(_.country,$);if($&&!e){const e=sprintf((0,r.__)("Wprowadzony numer NIP (%s) jest nieprawidłowy. Użyj następującego formatu: %s","woocommerce-eu-vat-number"),$,u(_.country));a({[S]:{message:e,hidden:!1}})}else(0,t.extensionCartUpdate)({namespace:"woocommerce-eu-vat-number",data:{billing_vat_number:$,validate_oss:V,billing_invoice_ask:C},cartPropsToReceive:["extensions"]}).then((()=>{V||$||s(S)}))})():(()=>{let e=l(_.country,$);if($&&!e){const e=sprintf((0,r.__)("Wprowadzony numer NIP (%s) jest nieprawidłowy. Użyj następującego formatu: %s","woocommerce-eu-vat-number"),$,u(_.country));a({[S]:{message:e,hidden:!1}})}else s(S),(0,t.extensionCartUpdate)({namespace:"woocommerce-eu-vat-number",data:{billing_vat_number:$,validate_oss:!1,billing_invoice_ask:C},cartPropsToReceive:["extensions"]}).then((()=>{L($)}))})()},customFormatter:e=>e.replace(/[^0-9A-Za-z]/g,"")}),N?.message&&!N?.hidden?(0,e.createElement)("div",{className:"wc-block-components-validation-error",role:"alert"},(0,e.createElement)("p",null,N.message)):null),(C||!x)&&V&&y&&!$&&k?(0,e.createElement)(m,{validation:n.validation,ipAddress:g.ip_address,ipCountry:g.ip_country,billingCountry:_.country,shouldValidateIp:k,checkoutExtensionData:o}):null,(C||!x)&&V&&y&&$&&!P?(0,e.createElement)(E,{validation:n.validation,checkoutExtensionData:o}):null))})),h={metadata:{...o,attributes:{...o.attributes,...d({defaultTitle:(0,r.__)("Numer NIP","woocommerce-eu-vat-number"),defaultDescription:"",defaultShowStepNumber:!0})}},component:t=>(0,e.createElement)(_,{isEditing:!1,...t})};(0,t.registerCheckoutBlock)(h)})()})();